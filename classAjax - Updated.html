<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Sabio - AJAX Lab Exercise</title>
    <!-- Custom styles for this template -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        a.navbar-brand {
            font-weight: 100;
            margin-top: 10px;
            padding: 0px 9px;
            line-height: 21px;
            text-transform: uppercase;
            font-size: 29px;
            display: block;
            float: left;
            height: 60px;
            line-height: 60px;
            font-family: 'Open Sans', Tahoma, sans-serif;
        }

        .navbar-brand, .navbar-nav > li > a {
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.25);
        }

        .well {
            padding: 10px 10px 0px 10px;
        }

        a.navbar-brand span {
            float: left;
            height: 20px;
            line-height: 20px;
        }

        form {
            margin-top: 10px;
        }

        a.navbar-brand small {
            color: green;
            font-size: 13px;
            height: 20px;
            line-height: 20px;
            font-weight: 100;
            text-transform: none;
            font-family: "Pacifico", Monaco, Consolas, monospace;
        }

        .author {
            background-color: #f5f5f5;
            margin-top: 10px;
            padding-top: 10px;
            border: 1px solid #e3e3e3;
            border-radius: 4px;
        }

        fieldset {
            min-height: 20px;
            padding: 19px;
            margin-bottom: 20px;
            border: 1px solid #e3e3e3;
            border-radius: 4px;
            -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.05);
            box-shadow: inset 0 1px 1px rgba(0,0,0,.05);
        }

        .delete {
            margin-right: 10px;
        }

        .name {
            font-weight: bold;
            color: royalblue;
        }

        .btn {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="register.html" class="navbar-brand ">
                    <span class="logo">
                        <strong>Sabio<br /></strong>
                        <small>AJAX Lab Exercise</small>
                    </span>
                </a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right visible-xs"></ul>
                <div class="nav navbar-nav navbar-right hidden-xs">
                    <div class="row">
                        <div class="pull-right">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <h3>
                    Manage Authors
                </h3>
                <div class="well">
                    <p>
                        REST API End Point - <a href="http://sabioapi2.azurewebsites.net/api/authors" target="_blank">http://sabioapi2.azurewebsites.net/api/authors</a>
                    </p>
                </div>
                <div class="row">
                    <div class="col-md-12 pull-right ">
                        <button type="button" class="pull-right btn btn-sm btn-warning" id="reloadBtn">Reload Authors</button>
                        <br />
                        <hr />
                    </div>
                    <div class="col-sm-12 col-md-8">
                        <form class="inputForm">
                            <fieldset>
                                <!-- Author form -->
                                <div>
                                    <div class="form-group">
                                        <label class="control-label">First Name</label>
                                        <div class="controls">
                                            <input type="text" class="form-control" id="firstName" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label">Last Name</label>
                                        <div class="controls">
                                            <input type="text" class="form-control" id="lastName" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label">Age</label>
                                        <input type="text" class="form-control" id="age" />
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label">Salary</label>
                                        <div class="controls">
                                            <select class="form-control" id="salary">
                                                <option>50000</option>
                                                <option>60000</option>
                                                <option>70000</option>
                                                <option>80000</option>
                                                <option>90000</option>
                                                <option>100000</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group  ">
                                        <div class="text-center">
                                            <input type="submit" id="btnSubmit" class="btn btn-primary" value="Add Author" />
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                    <div class="col-md-4  pull-right">
                        <div id="author-list">
                            <!-- SINGLE Author START -->
                            <div class="row author">
                                <div class="col-sm-offset-1 col-sm-9">
                                    <p class="name">Joe Smith</p>
                                    <p class="age"><span>27</span> years</p>
                                    <p class="salary">$ <strong>55000</strong></p>
                                    <p>ID: <small>123456789</small></p>
                                </div>
                                <input type="button" class="deleteBtn pull-right btn btn-sm btn-danger" value="x" />
                            </div>
                            <!-- SINGLE Author END
                            <!-- SINGLE Author START -->
                            <div class="row author">
                                <div class="col-sm-offset-1 col-sm-9">
                                    <p class="name">Another Author</p>
                                    <p class="age"><span>45</span> years</p>
                                    <p class="salary">$ <strong>75000</strong></p>
                                    <p>ID: <small>9876321</small></p>
                                </div>
                                <input type="button" class="deleteBtn pull-right btn btn-sm btn-danger" value="x" />
                            </div>
                            <!-- SINGLE Author END -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="container">
            <hr />
            <div class="row">
                <div class="col-sm-4 col-xs-12">
                    <p><strong>&copy; Sabio 2017</strong>  All rights reserved</p>
                </div>
                <div class="col-sm-8 col-xs-12">
                    <p class="footer-links">
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="http://sabioapi2.azurewebsites.net/scripts/sabio.js"></script>
    <!-- All your code goes below here-->
    <script type="text/javascript">
        sabio.page.startUp = function () {
            $("#reloadBtn").on("click", sabio.page.handlers.loadAuthor);
            sabio.page.ajax.get(sabio.page.ajax.onGetSuccess, sabio.page.ajax.onError);
            $("#btnSubmit").on("click", sabio.page.handlers.btnSubmit);
            $("#author-list").on("click", ".deleteBtn", sabio.page.handlers.deleteBtn);
            $("#author-list").on("click", ".author", sabio.page.handlers.updateAuthor);
        };

        sabio.page.handlers.updateAuthor = function () {
            var author = $(this);
            var data = sabio.page.readAuthor(author);
            sabio.page.writeForm(data);
            $("#btnSubmit").val("Update");
        };
        sabio.page.handlers.deleteBtn = function (evt) {
            evt.stopPropagation();
            var author = $(this).closest(".author");
            var id = author.find("p small").text();
            sabio.page.ajax.service.delete(id);
        };
        sabio.page.handlers.loadAuthor = function () {
            sabio.page.ajax.service.getAll();
        };
        sabio.page.handlers.btnSubmit = function (evt) {
            evt.preventDefault();
            var authorData = sabio.page.readForm();
            if (sabio.page.authorId) {
                authorData.id = sabio.page.authorId;
                sabio.page.ajax.service.update(authorData);
            } else {
                sabio.page.ajax.service.add(authorData);
            }
        };
        // new sabio object called ajax
        sabio.page.ajax = {
            url: "http://sabioapi2.azurewebsites.net/api/authors"
            , onAddSuccess: function (data, status, xhr) {
                sabio.page.clearForm();
                sabio.page.ajax.get(sabio.page.ajax.onGetSuccess, sabio.page.ajax.onError);
            }
            , onError: function (xhr, errorText, error) {

            }
            , add: function (data, onSuccess, onError) {
                var settings = {
                    type: "POST"
                    , headers: { "SABIO-AUTH": "U64HW30HF" }
                    , success: onSuccess
                    , error: onError
                    , contentType: "application/JSON"
                    , data: JSON.stringify(data)
                };
                $.ajax(sabio.page.ajax.url, settings);
            }
            , onGetSuccess: function (data, status, xhr) {
                for (var i = 0; i < data.items.length; i++) {
                    sabio.page.addAuthor(data.items[i]); // picks each author
                }
            }
            , get: function (onSuccess, onError) { // parameters defined in startUp
                // if one or more parameters are missing replace it with the if statements 
                if (!onSuccess) {
                    onSuccess = sabio.page.ajax.onGetSuccess;
                };
                if (!onError) {
                    onError = sabio.page.ajax.onError;
                };
                var settings = {
                    type: "GET"
                    , headers: { "SABIO-AUTH": "U64HW30HF" }
                    , success: onSuccess
                    , error: onError
                };
                $.ajax(sabio.page.ajax.url, settings);
            }


        };









        var comment = {
            //sabio.page.ajax.response = {
            //    error: function (xhr, errorText, error) {
            //        console.log(xhr);
            //    }
            //    , successGetAll: function (data, status, xhr) {
            //        //console.log(data);
            //        $("#author-list").empty(); // emptys the list when reloadbtn is clicked
            //        for (var i = 0; i < data.items.length; i++) {
            //            sabio.page.addAuthor(data.items[i]);
            //        }
            //    }
            //    , successAdd: function (data, status, xhr) {
            //        sabio.page.clearForm();
            //        sabio.page.ajax.service.getAll();
            //    }
            //    , successDelete: function (data, status, xhr) {
            //        sabio.page.ajax.service.getAll();
            //    }
            //    , successUpdate: function () {
            //        sabio.page.authorId = null;
            //        sabio.page.clearForm();
            //        sabio.page.ajax.service.getAll();
            //    }
            //};
            //sabio.page.ajax.settings = {
            //    //GETALLAUTHORS
            //    getAll: {
            //        type: "GET"
            //        , headers: { "SABIO-AUTH": "U64HW30HF" }
            //        , success: sabio.page.ajax.response.successGetAll
            //        , error: sabio.page.ajax.response.error
            //    }
            //    , add: {
            //        type: "POST"
            //        , headers: { "SABIO-AUTH": "U64HW30HF" }
            //        , success: sabio.page.ajax.response.successAdd
            //        , error: sabio.page.ajax.response.error
            //        , contentType: "application/JSON"

            //    }
            //    , delete: {
            //        type: "DELETE"
            //        , headers: { "SABIO-AUTH": "U64HW30HF" }
            //        , success: sabio.page.ajax.response.successDelete
            //        , error: sabio.page.ajax.response.error
            //        , contentType: "application/JSON"

            //    }
            //    , update: {
            //        type: "PUT"
            //        , headers: { "SABIO-AUTH": "U64HW30HF" }
            //        , success: sabio.page.ajax.response.successUpdate
            //        , error: sabio.page.ajax.response.error
            //        , contentType: "application/JSON"

            //    }
            //};
            //sabio.page.ajax.service = {
            //    getAll: function () {
            //        $.ajax(sabio.page.ajax.url, sabio.page.ajax.settings.getAll);
            //    }
            //    , add: function (data) {
            //        sabio.page.ajax.settings.add.data = JSON.stringify(data);
            //        $.ajax(sabio.page.ajax.url, sabio.page.ajax.settings.add);
            //    }
            //    , delete: function (id) {
            //        //sabio.page.ajax.settings.delete.data = '{"id":' + id + '}'; // same as below
            //        sabio.page.ajax.settings.delete.data = JSON.stringify({ id: id });
            //        $.ajax(sabio.page.ajax.url + "/" + id, sabio.page.ajax.settings.delete);
            //    }
            //    , update: function (data) {
            //        sabio.page.ajax.settings.update.data = JSON.stringify(data);
            //        $.ajax(sabio.page.ajax.url + "/" + data.id, sabio.page.ajax.settings.update);
            //    }
            //};
        }; // everything inside is commented out
        sabio.page.loadTemplate = function () {
            return $($("#template").html());
        };
        sabio.page.addAuthor = function (data) {
            var template = sabio.page.loadTemplate();
            template.find(".name").text(data.firtName + " " + data.lastName);
            template.find(".age span").text(data.age);
            template.find(".salary strong").text(data.salary);
            template.find("p small").text(data.id);
            $("#author-list").prepend(template);
        };
        sabio.page.readForm = function () {
            var firstName = $("#firstName").val();
            var lastName = $("#lastName").val();
            var age = $("#age").val();
            var salary = $("#salary").val();
            var author = {
                firstName: firstName
                , lastName: lastName
                , age: age
                , salary: salary
            };
            return author;
        };
        sabio.page.clearForm = function () {
            $("form")[0].reset();
            $("#btnSubmit").val("Add Author");
        };
        // this is for the update functionality
        sabio.page.readAuthor = function (author) {
            var name = author.find(".name").text();
            var names = name.split(" "); // splits the name where the space is
            var firstName = names[0];
            var lastName = names[1];
            var age = author.find(".age span").text();
            var salary = author.find(".salary strong").text();
            var id = author.find("p small").text();
            var author = {
                firstName: firstName
                , lastName: lastName
                , age: age
                , salary: salary
                , id: id
            };
            return author;
        };
        sabio.page.writeForm = function (data) {
            $("#firstName").val(data.firstName);
            $("#lastName").val(data.lastName);
            $("#age").val(data.age);
            $("#salary").val(data.salary);
            sabio.page.authorId = data.id;
        };

    </script>
    <script type="text/html" id="template">
        <div class="row author">
            <div class="col-sm-offset-1 col-sm-9">
                <p class="name">Another Author</p>
                <p class="age"><span>45</span> years</p>
                <p class="salary">$ <strong>75000</strong></p>
                <p>ID: <small>9876321</small></p>
            </div>
            <input type="button" class="deleteBtn pull-right btn btn-sm btn-danger" value="x" />
        </div>
    </script>
</body>
</html>
